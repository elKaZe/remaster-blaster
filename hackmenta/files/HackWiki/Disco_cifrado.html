<!DOCTYPE html>
<html lang="es" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8">
<title>Disco cifrado - HackLab de Barracas</title>
<meta name="generator" content="MediaWiki 1.22.0">
<meta name="robots" content="noindex,follow">
<meta name="description" content="La idea de esta guía es que todo todo lo que pase por nuestro disco quede cifrado o encriptado, manteniendo la posibilidad de suspender al disco, o sea hibernar, la máquina. Para eso es necesario que la swap esté
encriptada también. La forma más simple es hacer una partición para la swap
dentro de un volumen LVM creado sobre una partición encriptada completamente.">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="favicon.ico.html">
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php.html" title="HackLab de Barracas (es)">
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.hackcoop.com.ar/api.php?action=rsd">
<link rel="copyright" href="HackLab_de_Barracas:Derechos_de_autor.html">
<link rel="alternate" type="application/atom+xml" title="Feed Atom de HackLab de Barracas" href="index.php?title=Especial:CambiosRecientes&amp;feed=atom.html">
<link rel="stylesheet" href="ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style>a:lang(ar),a:lang(ckb),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wiki:resourceloader:filter:minify-css:7:da81894a262faddb62408789293d7adb */</style>

<meta property="og:type" content="article">
	<meta property="og:site_name" content="HackLab de Barracas">
	<meta property="og:title" content="Disco cifrado">
	<meta property="og:description" content="La idea de esta guía es que todo todo lo que pase por nuestro disco quede cifrado o encriptado, manteniendo la posibilidad de suspender al disco, o sea hibernar, la máquina. Para eso es necesario que la swap esté
encriptada también. La forma más simple es hacer una partición para la swap
dentro de un volumen LVM creado sobre una partición encriptada completamente.">
	<meta property="og:url" content="http://wiki.hackcoop.com.ar/Disco_cifrado">
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Disco_cifrado skin-bootstrap action-view">

			<nav class="navbar"><div class="navbar-inner"><div class="container">
<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a class="brand" href="P%C3%A1gina_principal.html">HackLab de Barracas</a><div id="user" class="pull-right btn-group">
<a href="index.php?title=Especial:Entrar&amp;returnto=Disco+cifrado&amp;returntoquery=printable%3Dyes.html" class="btn btn-warning">Iniciar sesión <icon class="icon-signin icon-white"></icon></a><button class="btn dropdown-toggle btn-warning" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu">
<li id="pt-uls" class="active"><a href="#" class="uls-trigger autonym">español</a></li>
<li id="pt-createaccount"><a href="index.php?title=Especial:Entrar&amp;returnto=Disco+cifrado&amp;returntoquery=printable%3Dyes&amp;type=signup.html">Crear una cuenta</a></li>
</ul>
</div>
<div class="nav-collapse"><ul class="nav">
<li> <a href="Categor%C3%ADa:Proyectos.html" title="Categoría:Proyectos">Proyectos</a>
</li>
<li> <a href="Categor%C3%ADa:Gu%C3%ADas.html" title="Categoría:Guías">Guías</a>
</li>
<li> <a rel="nofollow" class="external text" href="http://wiki.hackcoop.com.ar/index.php?title=Especial:Categor%C3%ADas&amp;limit=500">Categorías</a>
</li>
<li> <a href="Categor%C3%ADa:QueHacer.html" title="Categoría:QueHacer">Quehaceres</a>
</li>
<li> <a rel="nofollow" class="external text" href="http://irc.hackcoop.com.ar/">Chat</a>
</li>
<li> <a href="Crear_articulo.html" title="Crear articulo">Crear articulo</a>
</li>
<li> <a href="Especial:UploadWizard.html" title="Especial:UploadWizard">Subir archivos</a>
</li>
</ul></div>
</div></div>
<div id="page" class="pull-right"><ul class="nav nav-tabs">
<li id="ca-nstab-main" class="selected"><a href="Disco_cifrado.html" title="Ver el artículo [c]" accesskey="c">Página</a></li>
<li id="ca-talk" class="new"><a href="index.php?title=Discusi%C3%B3n:Disco_cifrado&amp;action=edit&amp;redlink=1.html" title="Discusión acerca del artículo [t]" accesskey="t">Discusión</a></li>
<li id="ca-viewsource"><a href="index.php?title=Disco_cifrado&amp;action=edit.html" title="Esta página está protegida.
Puedes ver su código fuente [e]" accesskey="e">Ver fuente</a></li>
<li id="ca-history"><a href="index.php?title=Disco_cifrado&amp;action=history.html" rel="archives" title="Versiones anteriores de esta página y sus autores [h]" accesskey="h">Historial</a></li>
</ul></div></nav>

			<div id="page" class="container container-fluid">

				<div class="row-fluid">
					<aside class="span3">
								<ul class="nav nav-stacked nav-pills">
<li><form action="/index.php" class="search"><input type="search" name="search" placeholder="Search" title="Buscar en HackLab de Barracas [f]" accesskey="f" id="searchInput" class="search-query"></form></li>
<li> <a href="P%C3%A1gina_principal.html" title="Página principal"><img alt="LogoHacklab.svg" src="../File:195px-LogoHacklab.svg.png" width="195" height="195" srcset="/images/thumb/9/9d/LogoHacklab.svg/293px-LogoHacklab.svg.png 1.5x, /images/thumb/9/9d/LogoHacklab.svg/390px-LogoHacklab.svg.png 2x"></a>
</li>
<li> <a href="Donaciones.html" title="Donaciones">Donaciones ♡</a>
</li>
<li> <a href="Crear_articulo.html" title="Crear articulo">Crear articulo</a>
</li>
<li> <a href="Especial:SubirArchivo.html" title="Especial:SubirArchivo">Subir un archivo</a>
</li>
<li> <a href="Especial:UploadWizard.html" title="Especial:UploadWizard">Subir archivos</a>
</li>
<li> <a href="Categor%C3%ADa:CositaLinda.html" title="Categoría:CositaLinda">Cositas Lindas</a>
</li>
<li> <a href="Especial:ListaIm%C3%A1genes.html" title="Especial:ListaImágenes">y más archivos</a>
</li>
<li> <a href="Categor%C3%ADa:Proyectos.html" title="Categoría:Proyectos">Proyectos</a>
</li>
<li> <a href="Categor%C3%ADa:QueHacer.html" title="Categoría:QueHacer">QueHaceres</a>
</li>
<li> <a href="Especial:P%C3%A1ginasEspeciales.html" title="Especial:PáginasEspeciales">Otras acciones</a>
</li>
</ul>
							</aside>
						
					<article id="content" class="span8" style="margin: 2em; margin-bottom: 0">
						<div class="page-header">
							<h1>
								Disco cifrado								<small></small>
							</h1>
						</div>	
						<div id="mw-content-text" lang="es" dir="ltr" class="mw-content-ltr">
<p><br>
La idea de esta guía es que todo todo lo que pase por nuestro disco quede cifrado o encriptado, manteniendo la posibilidad de suspender al disco, o sea <a rel="nofollow" class="external text" href="https://es.wikipedia.org/wiki/Hibernar">hibernar</a>, la máquina. Para eso es necesario que la <a rel="nofollow" class="external text" href="https://es.wikipedia.org/wiki/Espacio_de_intercambio">swap</a> esté
encriptada también. La forma más simple es hacer una partición para la swap
dentro de un volumen <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/LVM">LVM</a> creado sobre una partición encriptada completamente.
</p>
<div id="toc" class="toc">
<div id="toctitle"><h2>Contenido</h2></div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Llenar_el_disco_de_ruido"><span class="tocnumber">1</span> <span class="toctext">Llenar el disco de ruido</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Con_haveged"><span class="tocnumber">1.1</span> <span class="toctext">Con haveged</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Desde_otra_fuente_de_ruido"><span class="tocnumber">1.2</span> <span class="toctext">Desde otra fuente de ruido</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Particionar"><span class="tocnumber">2</span> <span class="toctext">Particionar</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Cifrar"><span class="tocnumber">3</span> <span class="toctext">Cifrar</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Crear_los_contenedores_LVM"><span class="tocnumber">4</span> <span class="toctext">Crear los contenedores LVM</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Formatear"><span class="tocnumber">5</span> <span class="toctext">Formatear</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Llenar_el_disco_de_ruido">Llenar el disco de ruido</span></h2>
<p>¿Por qué llenar el disco de ruido o datos aleatorios? Si nuestro disco está en
blanco (o sea en ceros) un análisis a bajo nivel puede mostrarlo así:
</p>
<pre>0000000000000000000000000000000000000000000000000000000000000
</pre>
<p>Si creamos una partición cifrada y guardamos datos, estos pueden verse,
dependiendo de en qué parte del disco se guardan, así:
</p>
<pre>h572hdasDAsdaudaDWadwdd33ahdCas000000000000000000000000000000
</pre>
<p>de esta forma se puede identificar claramente qué parte del disco contiene
datos cifrados y qué parte no, lo que reduce el esfuerzo necesario para
recuperar los datos. Asique llenamos el disco de ruido para impedir esta
identificación.
</p>
<h3><span class="mw-headline" id="Con_haveged">Con haveged</span></h3>
<p>El demonio <b>haveged</b> sirve para generar datos aleatorios (entropía, en
realidad) muy rápido. Si estamos instalando arch, el instalador de arch ya lo
trae y por default está corriendo, asique está listo para usar.
</p>
<p>Esos datos aleatorios se acceden desde <code>/dev/random</code>. Para llenar el disco
rígido (por ejemplo <code>/dev/sda</code>) con bloques de 4 megas (para aumentar un poco
el tamaño de bloque default que es de 512 bytes, aunque lo ideal sería usar el
mismo tamaño que el cache del disco rígido que vamos a llenar) usamos
</p>
<p><code>dd bs=4M if=/dev/random of=/dev/sda</code>
</p>
<h3><span class="mw-headline" id="Desde_otra_fuente_de_ruido">Desde otra fuente de ruido</span></h3>
<p>Una solución más rápida es copiar datos "aleatorios" ya generados desde otro
lado, como por ejemplo otro disco cifrado. Para copiar desde un disco conectado
por usb identificado como <code>/dev/sdc</code>
</p>
<p><code>dd bs=4M if=/dev/sdc of=/dev/sda skip=256</code>
</p>
<p><code>skip=n</code> salta <code>n</code> bloques de tamaño <code>bs</code> (en este caso 4MB * 254 = 1GB) para
evitar la cabecera del disco cifrado. Sin cabecera no hay forma de recuperar
los datos, lo que los convierte de hecho en ruido.
</p>
<p>Para copiar por la red local, podemos usar <b>netcat</b> (el comando <code>nc</code>) que
también viene instalado y listo para usar desde el instalador de arch. También
podríamos usar <b>ssh</b> pero sería más <a rel="nofollow" class="external text" href="http://www.ndchost.com/wiki/server-administration/netcat-over-ssh">lento</a> por el cifrado/descifrado que
implica para transmitir los datos. Ponemos netcat a escuchar en un puerto
cualquiera (<code>9000</code> en este caso) y redirigimos los datos a <b>dd</b> en la máquina
que estamos instalando
</p>
<p><code>nc -l -p 9000 | dd bs=4M of=/dev/sda</code>
</p>
<p>Y desde una máquina que pueda acceder por red a la otra (por ejemplo, con la IP
<code>10.0.0.2</code>) enviamos los datos desde el disco cifrado propio (acá <code>/dev/sdb</code>)
</p>
<p><code>dd if=/dev/sdb bs=4M skip=256 | nc 10.0.0.2 9000</code>
</p>
<h2><span class="mw-headline" id="Particionar">Particionar</span></h2>
<p>Hacer 2 particiones (<i>sda1</i> para boot, <i>sda2</i> para el lvm)
</p>
<p><code>fdisk /dev/sda</code>
</p>
<p>ambas de tipo <i>linux</i> (lvm no mira el tipo de partición)
</p>
<h2><span class="mw-headline" id="Cifrar">Cifrar</span></h2>
<p>Encriptamos sda2:
</p>
<p><code>cryptsetup --key-size 512 --use-random luksFormat /dev/sda2</code>
</p>
<p>Chequeamos que esté todo bien:
</p>
<p><code>cryptsetup luksDump /dev/sda2</code>
</p>
<p>Abrimos la partición encriptada:
</p>
<p><code>cryptsetup open --type luks /dev/sda2 sarasa</code>
</p>
<h2><span class="mw-headline" id="Crear_los_contenedores_LVM">Crear los contenedores LVM</span></h2>
<ol>
<li>
Crear un volumen físico (physical volume)

<code>pvcreate /dev/mapper/sarasa</code>

</li>
<li>
Crear un grupo de volúmenes (volume group)

<code>vgcreate fafafa /dev/mapper/sarasa</code>

En este ejemplo el volume group se llama <i>fafafa</i>.
</li>
<li>Crear volúmenes lógicos (logical volumes)

<ol>
<li>Uno especial para la swap

<code>lvcreate -C y -L 8G fafafa -n swap</code>

Debe ser del mismo tamaño que la RAM de la computadora, para poder hibernar.
</li>
<li>Todos los demás

<code>lvcreate -L 50G fafafa -n root</code>

para poner el resto en el home podemos fijarnos el total disponible con

<code>vgdisplay | grep Free</code>

y especificarlo:

<code>lvcreate -L 870G fafafa -n home</code>

o le decimos a <code>lvcreate</code> que lo calcule directamente:

<code>lvcreate -L -l +100%FREE fafafa -n home</code>

(nótese la <code>l</code> (ele) minúscula)
</li>
</ol>
</li>
</ol>
<h2><span class="mw-headline" id="Formatear">Formatear</span></h2>

</div>						<footer><div id="catlinks" class="catlinks well"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="Especial:Categor%C3%ADas.html" title="Especial:Categorías">Categorías</a>: <ul>
<li><a href="Categor%C3%ADa:Cifrado.html" title="Categoría:Cifrado">Cifrado</a></li>
<li><a href="Categor%C3%ADa:Gu%C3%ADas.html" title="Categoría:Guías">Guías</a></li>
</ul>
</div></div></footer>
											</article>
				</div>

				<ul class="horizontal">
<li> <a href="HackLab_de_Barracas:Derechos_de_autor.html" title="HackLab de Barracas:Derechos de autor">Licencia</a>
</li>
<li> <a href="Donaciones.html" title="Donaciones">Donaciones ♡</a>
</li>
<li> <a rel="nofollow" class="external text" href="http://fm.hackcoop.com.ar/">Radios</a>
</li>
<li> <a href="Categor%C3%ADa:Campa%C3%B1as.html" title="Categoría:Campañas">Campañas</a>
</li>
<li> <a rel="nofollow" class="external text" href="http://hackcoop.com.ar/listas/">Listas de correo</a>
</li>
<li> <a href="Especial:P%C3%A1ginasEspeciales.html" title="Especial:PáginasEspeciales">Páginas especiales</a>
</li>
<li> <a href="Glosario.html" title="Glosario" class="mw-redirect">Glosario</a>
</li>
</ul>
<ul class="horizontal">
<li><a href="HackLab_de_Barracas:Pol%C3%ADtica_de_protecci%C3%B3n_de_datos.html" title="HackLab de Barracas:Política de protección de datos">Política de protección de datos</a></li>
<li><a href="HackLab_de_Barracas:Acerca_de.html" title="HackLab de Barracas:Acerca de">Acerca de HackLab de Barracas</a></li>
<li><a href="HackLab_de_Barracas:Limitaci%C3%B3n_general_de_responsabilidad.html" title="HackLab de Barracas:Limitación general de responsabilidad">Aviso legal</a></li>
</ul>
<ul class="horizontal pull-right"><li><a href="/www.mediawiki.org/.html"><img src="/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31"></a></li></ul>

			</div> </body>
			</html>
